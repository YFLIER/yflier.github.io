<html>
<head>

<meta charset="utf-8" />

<script type="text/javascript" src="http://www.w3school.com.cn/jquery/jquery.js"></script>

<script type="text/javascript">
    //task: [{"tracks":[{name:, src:, dur:, loop:}, {}], "loop":2}]
    function SPlayer(aud_id, plist) {
        this.audio = $("#"+aud_id)[0];
        
        this.curPlayList = plist;
        this.curGroupId = 0;
        this.curTrackId = -1;
        this.curTrackPos = 0;
        this.curTrackLooper = 1;
        
        this.setAudio = function(aud_id) {
        	this.audio = $("#"+aud_id)[0];
        }
        
        this.setCurTrackPos = function(pos) {
        	this.curTrackPos = pos;
        }
        
        this.setCurPlayList = function(plist) {
            this.curPlayList = plist;
        }
        
        this.getTrackLoop = function(gid, id) {
            if (this.curPlayList.length > gid) {
                var glist = this.curPlayList[gid];
                var tracks = glist.tracks;
                if (tracks.length > id) {
                    return this.curPlayList[gid].tracks[id].loop;
                }
            }
            return 0;
        }
        
        this.setTrackLoop = function(gid, id, iv) {
            if (this.curPlayList.length > gid) {
                var glist = this.curPlayList[gid];
                var tracks = glist.tracks;
                if (tracks.length > id) {
                    this.curPlayList[gid].tracks[id].loop = iv;
                }
            }
        }
        
        this.getCurTrack = function() {
            return this.curPlayList[0].tracks[this.curTrackId];
        }
        
        this.getTracksSize = function() {
            return this.curPlayList[0].tracks.length;
        }
        
        this.getCurTrackName = function() {
            return this.getCurTrack().name;
        }
        
        this.getCurTrackSrc = function() {
            return this.getCurTrack().src;
        }
        
        this.getCurTrackDuration = function() {
            return this.getCurTrack().dur;
        }
        
        this.getCurTrackLoop = function() {
            return this.getCurTrack().loop;
        }
        
        this.start = function() {
            if (this.curTrackId < 0) {
                for (var i=0; i<this.getTracksSize(); i++) {
                    if (this.getTrackLoop(0, i) > 0) {
                        this.curTrackId = i;
                        this.curTrackPos = 0;
                        this.curTrackLooper = 1;
                        this.audio.src = this.getCurTrackSrc();
                        break;
                    }
                }
            } else if (this.audio.src == '') {
                this.audio.src = this.getCurTrackSrc();
            }
            this.audio.play();
        }
        
        this.pause = function() {
            this.audio.pause();
        }
        
        this.playNext = function() {
            if (this.curTrackLooper < this.getCurTrackLoop()) {
                this.curTrackLooper = this.curTrackLooper+1;
                this.audio.src = this.getCurTrackSrc();
                this.audio.play();
            } else {
                for (var i=this.curTrackId; i<this.getTracksSize(); i++) {
                    if (this.getTrackLoop(0, i) > 0) {
                        this.curTrackId = i;
                        this.curTrackPos = 0;
                        this.curTrackLooper = 1;
                        this.audio.src = this.getCurTrackSrc();
                        this.audio.play();
                    }
                }
            }
        }
    }
    
    fastAlbumIds = [["Big Steps 3", "4534989"], ["HaiDiXiaoZongDui[BaBaMaMa]", "3746044"]];
    
	function deloop(id, sp) {
		jqid = "#lp"+id;
		jqid2 = "#nm"+id;
		sv = $(jqid).attr("value");
		iv = parseInt(sv);
		if (iv > 0) {
			iv = iv-1;
			$(jqid).attr("value", ""+iv);
			sp.setTrackLoop(0, id, iv);
			if (iv <= 0) {
				$(jqid2).css("color", "black");
			}
		}
	}
	
	function adloop(id, sp) {
		jqid = "#lp"+id;
		jqid2 = "#nm"+id;
		sv = $(jqid).val();
		iv = parseInt(sv);
		if (iv < 100) {
			iv = iv+1;
			$(jqid).val(""+iv);
			sp.setTrackLoop(0, id, iv);
			if (iv > 0) {
				$(jqid2).css("color", "red");
			}
		}
	}
	
	function startPlay(sp) {
	    sp.start();
	}
	
	function pausePlay(sp) {
	    sp.pause();
	}
	
	function xmlyParseResult(str) {
		// {"ret":200,"msg":"声音播放数据","data":{"uid":0,"albumId":14164578,"sort":0,"pageNum":1,"pageSize":30,"tracksAudioPlay":[{"index":1,"trackId":76051589,"trackName":"见识――序言","trackUrl":"/youshengshu/14164578/76051589","trackCoverPath":"//imagev2.xmcdn.com/group40/M07/5F/63/wKgJVFqlNSPy8FjeAARtk-rVxwU192.jpg","albumId":14164578,"sourceAlbumId":14164578,"albumName":"见识","albumUrl":"/youshengshu/14164578/","anchorId":20248460,"canPlay":true,"isBaiduMusic":false,"isPaid":false,"duration":1297,"src":"http://audio.xmcdn.com/group41/M0B/97/53/wKgJ8VqlNefiN57XAKBUgfCbGLI014.m4a","hasBuy":true,"albumIsSample":false,"sampleDuration":0,"updateTime":"11月前","createTime":"11月前","isLike":false,"isCopyright":true},
		data = JSON.parse(str);
		ret = [];
		if (data.ret == 200) {
			data2 = data.data;
			tracks = data2.tracksAudioPlay;
			for (i=0; i<tracks.length; i++) {
				r = {};
				r["name"] = tracks[i].trackName;
				r["dur"] = tracks[i].duration;
				r["src"] = tracks[i].src;
				r["loop"] = 0;
				ret[i] = r;
			}
		}
		return ret;
	}

	function xmlyGetList(aid) {
	    // https://www.ximalaya.com/revision/play/album?albumId=14164578&pageNum=1&sort=0&pageSize=30
	    _ret = [];
	    for (j=1;j>0;j++) {
	        _url = "https://www.ximalaya.com/revision/play/album?albumId="+aid+"&pageNum="+j+"&sort=0&pageSize=30";
            htmlobj=$.ajax({url:_url,async:false});
  	        resp = htmlobj.responseText;
  	        list = xmlyParseResult(resp);
  	        if (list.length == 0) {
  	            break;
  	        }
  	        _ret.push.apply(_ret, list);
  	    }
  	    return _ret;
	}
</script>
<script type="text/javascript">
    var sp;
    function onReady() {
        list = xmlyGetList("4534989");

        sp = new SPlayer("myaudio", [{tracks:list, loop:1}]);
        
      	str = '';
    	for (i=0; i < list.length; i++) {
    		name = list[i].name;
    		str = str + '<button id="de'+i+'" onclick="deloop('+i+', sp);">-</button><input id="lp'+i+'" type="text" size="2" value="0"></input><button id="ad'+i+'" onclick="adloop('+i+', sp)">+</button>'+'<span id="nm'+i+'">'+name+'</span><br/>';
    	}
    	$("#plist").html(str);
    }
    $(document).ready(onReady);
</script>
</head>
<body>
<div>
    <audio id='myaudio' controls='controls'></audio>
    <br/>
    <button id="start" onclick="startPlay(sp);">start</button><button id="pause" onclick="pausePlay(sp);">pause</button>
</div>
<p>
Fast ID: <button id="l-bigsteps3">bigsteps3's id</button><button id="l-bigsteps3">bigsteps3's id</button>
</p>
<p>
Customize ID: <input id="cusid" size="10"></input><button id="custom">Custom</button>
</p>
Current ID: <span id="curid"></span>
<div id="plist">
</div>
</body>
</html>